---
import { gql, GraphQLClient } from 'graphql-request';

const endpoint = 'http://justinmeader.local/graphql';
const graphQLClient = new GraphQLClient(endpoint);

const query = gql`
  query GetPosts {
    posts(first: 5, where: {status: PUBLISH}) {
      nodes {
        id
        title
        slug
        excerpt
        content
        date
        featuredImage {
          node {
            sourceUrl
          }
        }
        author {
          node {
            name
          }
        }
      }
    }
  }
`;

let posts = [];

try {
  const data = await graphQLClient.request(query);
  posts = data.posts.nodes;
} catch (error) {
  console.error('Error fetching data:', error);
}
---

<h1>Test GraphQL Connection</h1>
<ul>
  {posts.map(post => (
    <li key={post.id}>
      <h2>{post.title}</h2>
      <p>
        <strong>By:</strong> {post.author?.node?.name} on {new Date(post.date).toLocaleDateString()}
      </p>
      <img src={post.featuredImage?.node?.sourceUrl} alt={post.title} />
      <p dangerouslySetInnerHTML={{ __html: post.excerpt }}></p>
    </li>
  ))}
</ul>
